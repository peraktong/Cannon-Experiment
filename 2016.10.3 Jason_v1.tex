% ****** Start of file apssamp.tex ******
%
%   This file is part of the APS files in the REVTeX 4.1 distribution.
%   Version 4.1r of REVTeX, August 2010
%
%   Copyright (c) 2009, 2010 The American Physical Society.
%
%   See the REVTeX 4 README file for restrictions and more information.
%
% TeX'ing this file requires that you have AMS-LaTeX 2.0 installed
% as well as the rest of the prerequisites for REVTeX 4.1
%
% See the REVTeX 4 README file
% It also requires running BibTeX. The commands are as follows:
%
%  1)  latex apssamp.tex
%  2)  bibtex apssamp
%  3)  latex apssamp.tex
%  4)  latex apssamp.tex
%
\documentclass[%
 reprint,
%superscriptaddress,
%groupedaddress,
%unsortedaddress,
%runinaddress,
%frontmatterverbose, 
%preprint,
%showpacs,preprintnumbers,
%nofootinbib,
%nobibnotes,
%bibnotes,
 amsmath,amssymb,
 aps,
%pra,
%prb,
%rmp,
%prstab,
%prstper,
%floatfix,
]{revtex4-1}

\usepackage{graphicx}% Include figure files
\usepackage{dcolumn}% Align table columns on decimal point
\usepackage{bm}% bold math
%\usepackage{hyperref}% add hypertext capabilities
%\usepackage[mathlines]{lineno}% Enable numbering of text and display math
%\linenumbers\relax % Commence numbering lines

%\usepackage[showframe,%Uncomment any one of the following lines to test 
%%scale=0.7, marginratio={1:1, 2:3}, ignoreall,% default settings
%%text={7in,10in},centering,
%%margin=1.5in,
%%total={6.5in,8.75in}, top=1.2in, left=0.9in, includefoot,
%%height=10in,a5paper,hmargin={3cm,0.8in},
%]{geometry}

\begin{document}

\preprint{APS/123-QED}

\title{Optimized Synthesized Spectrum}% Force line breaks with \\
\thanks{A footnote to the article title}%

\author{Jason Cao}
 \altaffiliation[Also at ]{Physics Department, New York University.}%Lines break automatically or can be forced with \\

\affiliation{%
 Physics Department, New York University
}%


\date{\today}% It is always \today, today,
             %  but any date may be explicitly specified

\begin{abstract}
The Cannon 2 is a powerful tool, which can infer labels from the spectrum after it's trained. Also, it can generate the spectrum. Here we start at the point that the model is trained. First, infer the spectrum by using the Cannon 2. Then optimize the method and generate a better spectrum. Finally, compare the synthesized spectrum with the real spectrum and check whether the optimization works.
\begin{description}

\item[Structure]
The first part describes how to synthesize the spectrum from the Cannon 2. The second part talks about how to optimize the method and generate a better synthesized spectrum. Finally, we compare the results .
\end{description}
\end{abstract}

\pacs{}% PACS, the Physics and Astronomy
                             % Classification Scheme.
%\keywords{Suggested keywords}%Use showkeys class option if keyword
                              %display desired
\maketitle

%\tableofcontents

\section{\label{sec:level1}Infer spectrum by using the Cannon 2}

Suppose we have a trained model. The training set contains 548 stellar and each stellar spectrum has 8575 pixels. 

The model we adopt
 \[y_{jn} = v(l_n) \cdot \theta_{j} + e_{jn} (1)\]                      
 
 Where \(y_{jn}\) is the spectrum data for star n at wavelength pixel j. 
 And \(v(l_n)\) is the vectorizing function. 
The input \(l_n\) is the label list of length K for star n and the  output 
\(v(l_n)\) is a vector of length D (D is bigger than K).
\( \theta_{j}\) is a vector of length D of parameters which controlling the model at wavelength pixel j.
\( e_{jn}\) is a noise draw or residual at pixel j for star n.


The inferred label for stellar n \(l_n^{inferred}\) and \( \theta_{j}\) are available after the training step.
Then infer spectrum by using:
 \[y_{jn}^{inferred} = v(l_n^{inferred}) \cdot \theta_{j}  \]
 
 This is how to obtain the synthesized spectrum by using the Cannon 2.
 
 \bigskip
 The code is as followed:
 
 \bigskip
inferred\_labels = model.fit\_labelled\_set()

 \bigskip
v = model.vectorizer.get\_label\_vector(inferred\_labels)

 \bigskip
inferred\_flux = np.dot(v,model.theta.T)
 
 
 
 %% second paragraph
 
 \section{\label{sec:level1}optimize the inferred spectrum}

The Cannon 2 can predict the spectrum pretty well. But we can still improve it.
\bigskip

From the inferred spectrum \(y_{jn}^{inferred}\), we optimize it and generate a better synthesized spectrum, which we call \(y_{jn}^{optimized}\).
\bigskip

The method we use is to represent the spectrum at pixel j by using the inferred spectrum at pixel j-1,pixel j and pixel j+1.(If the pixel is out of range, set the flux as 1). 

\[y_{j,n}^{optimized}=a\cdot y_{j-1,n}^{inferred}+b\cdot y_{j,n}^{inferred}+c\cdot y_{j+1,n}^{inferred}(2)\]
\bigskip
 
 
Then fit \(y_{j,n}^{optimized} \) with \(y_{jn}\), where \(y_{jn}\) is the spectrum data for star n at wavelength pixel j. 
a+b+c should be equal to 1.
\bigskip

The code is as followed:
\bigskip

\bigskip

popt, pcov= optimization.curve\_fit(func, (x\_data, y\_data, z\_data),nor\_r, x0)
\bigskip

\bigskip

parameters = popt
\bigskip

x\_data, y\_data and z\_data are \(y_{j-1,n}^{inferred},y_{j,n}^{inferred} \)

and \( y_{j+1,n}^{inferred}\)
\bigskip

parameters are a, b and c
\bigskip

The result is \(a+b+c = 0.983661295269\). To make a+b+c=1, set a = a/(a+b+c)

b = b/(a+b+c) c = c/(a+b+c)

Calculate the optimized spectrum \( y_{j,n}^{optimized}\) by using (2)

%% Third paragraph
 
 \section{\label{sec:level1}Compare the two methods.}
 
 The blue line "Observed" is the observed spectrum from the data  \(y_{jn}\).
 The green line "inferred" is \( y_{j,n}^{inferred}\) , which is generated by the Cannon 2.
 The red line "optimized" is \( y_{j,n}^{optimized}\), which is generated by (2)
 
\includegraphics[width=70mm]{figure_1.png}
 
 

 
 Then compare the chi-square for a random stellar of the two methods:
 chi-square for \( y_{j,n}^{inferred}\) and \( y_{j,n}^{optimized}\) are 145.84 and 145.89
 They are similar to each other.
 
 



\end{document}
%
% ****** End of file apssamp.tex ******